<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>com.sap.ord</groupId>
    <artifactId>annotations</artifactId>
    <version>1.0.2</version>
  </parent>

  <artifactId>ord-models</artifactId>
  <name>ORD Java Models</name>

   <properties>
    <maven.compiler.source>1.8</maven.compiler.source>
    <maven.compiler.target>1.8</maven.compiler.target>
  </properties>

  <dependencies>
    <dependency>
      <groupId>com.fasterxml.jackson.core</groupId>
      <artifactId>jackson-annotations</artifactId>
      <version>2.17.0</version>
    </dependency>
     <dependency>
      <groupId>com.sap.ord</groupId>
      <artifactId>ord-service</artifactId>
      <version>1.0.1</version>
    </dependency>
  </dependencies>

  <build>
    <resources>
      <resource>
        <directory>${project.basedir}/static/spec-v1/interfaces</directory>
        <includes>
          <include>Document.schema.json</include>
        </includes>
        <targetPath>schemas</targetPath>
      </resource>
    </resources>

      <plugins>

          <!-- 1. JSON schema -> POJO directly in src/main/java -->
          <plugin>
              <groupId>org.jsonschema2pojo</groupId>
              <artifactId>jsonschema2pojo-maven-plugin</artifactId>
              <version>1.2.2</version>
              <executions>
                  <execution>
                      <id>generate-models</id>
                      <phase>generate-sources</phase>
                      <goals>
                          <goal>generate</goal>
                      </goals>
                  </execution>
              </executions>
              <configuration>
                  <sourceDirectory>${project.basedir}/static/spec-v1/interfaces</sourceDirectory>
                  <outputDirectory>${project.basedir}/src/main/java</outputDirectory>
                  <targetPackage>com.sap.ord.model</targetPackage>
                  <generateBuilders>true</generateBuilders>
                  <removeOldOutput>true</removeOldOutput>
              </configuration>
          </plugin>

          <!-- 2. Patch all generated POJOs to implements PartialOrdPojo -->
          <plugin>
              <artifactId>maven-antrun-plugin</artifactId>
              <version>3.1.0</version>
              <executions>
                  <execution>
                      <id>patch-partial-interface</id>
                      <phase>generate-sources</phase>
                      <goals>
                          <goal>run</goal>
                      </goals>
                      <configuration>
                          <target>
                              <replaceregexp byline="true" flags="g">
                                  <!-- all generated POJOs -->
                                  <fileset dir="${project.basedir}/src/main/java/com/sap/ord/model">
                                      <include name="**/*.java"/>
                                  </fileset>
                                  <!-- Search pattern -->
                                  <regexp pattern="public class ([A-Za-z0-9_]+) \{" />
                                  <!-- Inserting the interface -->
                                  <substitution expression="public class \1 implements com.sap.ord.service.hooks.PartialOrdPojo {" />
                              </replaceregexp>
                          </target>
                      </configuration>
                  </execution>
              </executions>
          </plugin>



          <!-- 3. Java-Compiler -->
          <plugin>
              <groupId>org.apache.maven.plugins</groupId>
              <artifactId>maven-compiler-plugin</artifactId>
              <version>3.10.1</version>
              <configuration>
                  <source>${maven.compiler.source}</source>
                  <target>${maven.compiler.target}</target>
              </configuration>
          </plugin>

      </plugins>
  </build>
</project>
